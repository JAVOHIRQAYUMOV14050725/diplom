<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RFID PRO | Xavfsiz Kirish</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  
  <style>
    body {
      font-family: 'Plus Jakarta Sans', sans-serif;
      margin: 0;
      overflow: hidden;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    /* Futuristik Fon */
    .bg-animated {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: radial-gradient(circle at 50% 50%, #1e1b4b 0%, #020617 100%);
    }

    .blob {
      position: absolute;
      width: 500px;
      height: 500px;
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.4) 0%, rgba(147, 51, 234, 0.4) 100%);
      filter: blur(80px);
      border-radius: 50%;
      z-index: -1;
      animation: move 20s infinite alternate;
    }

    @keyframes move {
      from { transform: translate(-10%, -10%); }
      to { transform: translate(20%, 20%); }
    }

    /* Glassmorphism Card */
    .login-card {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
      width: 100%;
      max-width: 420px;
      padding: 40px;
      border-radius: 32px;
      position: relative;
      overflow: hidden;
    }

    .login-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
      transition: 0.5s;
    }

    .login-card:hover::before {
      left: 100%;
    }

    .input-group {
      position: relative;
      margin-bottom: 24px;
    }

    .input-field {
      width: 100%;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 14px 16px 14px 48px;
      border-radius: 14px;
      color: white;
      outline: none;
      transition: all 0.3s;
    }

    .input-field:focus {
      border-color: #6366f1;
      background: rgba(255, 255, 255, 0.07);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
    }

    .btn-login {
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      color: white;
      width: 100%;
      padding: 14px;
      border-radius: 14px;
      font-weight: 600;
      letter-spacing: 0.5px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-login:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.5);
    }

    .btn-login:active { transform: translateY(0); }

    .error-msg {
      background: rgba(244, 63, 94, 0.1);
      border-left: 4px solid #f43f5e;
      color: #fb7185;
      padding: 12px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
      margin-bottom: 20px;
      animation: shake 0.4s cubic-bezier(.36,.07,.19,.97) both;
    }

    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }

    .loader {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
      display: none;
    }

    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>

  <div class="bg-animated">
    <div class="blob"></div>
    <div class="blob" style="right: 10%; bottom: 10%; animation-delay: -5s;"></div>
  </div>

  <div class="login-card">
    <div class="text-center mb-10">
      <div class="inline-flex p-4 rounded-2xl bg-indigo-600/20 mb-4 border border-indigo-500/30">
        <i data-lucide="shield-lock" class="text-indigo-400 w-10 h-10"></i>
      </div>
      <h1 class="text-2xl font-bold text-white tracking-tight">Admin Portalga Kirish</h1>
      <p class="text-slate-400 text-sm mt-2">Xavfsiz RFID boshqaruv tizimi</p>
    </div>

    <div id="err" class="error-msg">
      Xatolik: Ma'lumotlar noto'g'ri kiritildi
    </div>

    <form id="loginForm" onsubmit="event.preventDefault(); login();">
      <div class="input-group text-slate-400 focus-within:text-indigo-400 transition-colors">
        <i data-lucide="user" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5"></i>
        <input id="username" type="text" placeholder="Username" required class="input-field">
      </div>

      <div class="input-group text-slate-400 focus-within:text-indigo-400 transition-colors">
        <i data-lucide="key-round" class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5"></i>
        <input id="password" type="password" placeholder="Password" required class="input-field">
      </div>

      <button id="loginBtn" type="submit" class="btn-login">
        <span id="btnText">Tizimga kirish</span>
        <div id="loader" class="loader"></div>
      </button>
    </form>

    <div class="mt-8 pt-8 border-t border-white/5 text-center">
      <p class="text-xs text-slate-500 uppercase tracking-widest font-semibold">Security Level: Enterprise</p>
    </div>
  </div>

  <script>
    // Lucide ikonkalarni yaratish
    lucide.createIcons();

    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      const errBox = document.getElementById('err');
      const btnText = document.getElementById('btnText');
      const loader = document.getElementById('loader');
      const loginBtn = document.getElementById('loginBtn');

      // UI reset va Loading holati
      errBox.style.display = 'none';
      btnText.style.display = 'none';
      loader.style.display = 'block';
      loginBtn.disabled = true;

      try {
        const r = await fetch('/api/rfid/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        if (!r.ok) {
          throw new Error("Login yoki parol noto'g'ri");
        }

        const { token } = await r.json();
        localStorage.setItem('token', token);
        
        // Muvaffaqiyatli kirish effekti
        loginBtn.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
        btnText.innerText = "Muvaffaqiyatli!";
        btnText.style.display = 'block';
        loader.style.display = 'none';

        setTimeout(() => {
          location.href = '/admin/';
        }, 800);

      } catch (err) {
        // Xatolik holati
        errBox.innerText = err.message;
        errBox.style.display = 'block';
        btnText.style.display = 'block';
        loader.style.display = 'none';
        loginBtn.disabled = false;
        
        // Parol maydonini tozalash va diqqatni jalb qilish
        document.getElementById('password').value = '';
        document.getElementById('password').focus();
      }
    }
  </script>
</body>
</html>